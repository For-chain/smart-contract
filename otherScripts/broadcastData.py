#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import sys
from web3 import Web3, HTTPProvider
from config import *

w3 = Web3(HTTPProvider(BSC_RPC_URL_MAIN))
nonce_1 = w3.eth.get_transaction_count(WALLET_ADDRESS_2)


def broadcast_data(privateKey, nonce, value, toAddress, calldata):
    tx = {
        'nonce': nonce,
        'to': toAddress,
        'value': w3.to_wei(value, 'ether'),
        'gas': 1000000,
        'gasPrice': w3.to_wei(BSC_GWEI_TEST, 'gwei'),
        'data': calldata,
    }

    signed_tx = w3.eth.account.sign_transaction(tx, private_key=privateKey)
    tx_hash = w3.eth.send_raw_transaction(signed_tx.rawTransaction)
    print(Web3.to_hex(tx_hash))
    # receipt = self.w3.eth.wait_for_transaction_receipt(tx_hash)
    # print(receipt)
    # print(Web3.to_hex(receipt['logs'][2]['topics'][1]))
    # trade_hash = Web3.to_hex(receipt['logs'][2]['topics'][1])
    # return trade_hash


if __name__ == '__main__':
    data = '0x07ed2379000000000000000000000000e37e799d5077682fa0a244d46e5649f71457bd090000000000000000000000009ec02756a559700d8d9e79ece56809f7bcc5dc2700000000000000000000000055d398326f99059ff775485246999027b3197955000000000000000000000000e37e799d5077682fa0a244d46e5649f71457bd0900000000000000000000000010a425dc64ab724453005fe9463f5c7e9b0f08f80000000000000000000000000000000000000000000021cd132a3f8ac4fe75b5000000000000000000000000000000000000000000000000004b0befaff679120000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000000f40000000000000000000000000000000000000000000000000000000000d600a007e5c0d20000000000000000000000000000000000000000000000000000b200006302a000000000000000000000000000000000000000000000000000002023e522dec2ee63c1e5816cd061334aafee6cdd5bc5c958e71f769d7ca8cc9ec02756a559700d8d9e79ece56809f7bcc5dc27ec303ce1edbebf7e71fc7b350341bb6a6a7a638100a0c028b46d07ec303ce1edbebf7e71fc7b350341bb6a6a7a6381000000000000000000000000000000000000000000000000004b0befaff67912111111125421ca6dc452d289314280a0f8842a65000000000000000000000000b3276493'
    broadcast_data(WALLET_PRIVATE_KEY_2, nonce_1, 0, ONEINCH_ROUTER, data)